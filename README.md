# Citrix ADC RCE CVE-2023-3519

This exploit targets the vulnerabilities found in Citrix ADC RCE CVE-2023-3519. It primarily focuses on Citrix VPX 13.1-48.47, though it might have broader implications. A detailed writeup about this CVE and its exploitation is available [here](https://bishopfox.com/blog/analysis-exploitation-cve-2023-3519).

### Prerequisites 

Ensure you have NASM installed to build the shellcode:

```
$ sudo apt install nasm
```

### Usage

To utilize the exploit, run:

```
$ python3.10 exploit.py -h
```

**Options**:

- `--target TARGET` : Specify the target in the format of an URL or ip:port.
- `--file FILE` : Use a file containing a list of targets (one per line).
- `--output OUTPUT` : Define an output file for vulnerable targets.
- `--threads THREADS` : Determine the number of threads to use.

#### Automatic Callback URL Generation

The exploit is designed to automatically generate a callback URL using a specific short-link service. This is an integral part of the exploit process. However, it's critical to use this feature responsibly:

1. **Privacy**: The generated URL should always be kept private. Do not share or disclose this URL.
2. **Usage Limitation**: Due to its potent nature, refrain from excessive usage to avoid unintended consequences and potential service abuse. 

### Shellcode Artifacts

Once exploited:

1. A PHP backdoor will be created at `/var/netscaler/logon/a.php`.
2. The SUID bit on `/bin/sh` is set.

The provided `sh` payload illustrates how to automatically remove these artifacts. Be aware that the shellcode does not close its file descriptors, so repeatedly using the exploit might lead to resource exhaustion.

### Adapting to Other Versions

To adapt the exploit for FreeBSD-based Citrix targets, you'd need to identify:

1. The offset of the saved return pointer.
2. A `jmp rsp` ROP gadget or its equivalent.
3. The jump address that prevents a crash.

These parameters are specified at the start of the `exploit.py` script. Some versions might require a fourth value to adjust the RBP value.
